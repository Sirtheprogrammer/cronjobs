name: sirtheprogrammer

on:
  push:
    branches: [main]

  schedule:
    - cron: "0 7,9,12,13,14 * * *"

  workflow_dispatch:
    inputs:
      force:
        description: "Force commit even if no changes"
        required: false
        default: "false"

concurrency:
  group: auto-commit-main
  cancel-in-progress: true

permissions:
  contents: write

jobs:
  auto_commit:
    runs-on: ubuntu-latest

    env:
      TZ: Africa/Dar_es_Salaam
      MIN_COMMITS: 2
      MAX_COMMITS: 10

    steps:
      - name: ğŸ§ª Debug Info
        run: |
          echo "Ref: $GITHUB_REF"
          echo "Actor: $GITHUB_ACTOR"
          echo "Repo: $GITHUB_REPOSITORY"

      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ•’ Update timestamp
        run: |
          date '+%Y-%m-%d %H:%M:%S %Z' > LAST_UPDATED

      - name: ğŸ”§ Configure Git
        run: |
          git config user.name "auto-bot"
          git config user.email "auto-bot@users.noreply.github.com"

      - name: ğŸ² Generate commits
        run: |
          messages=(
            "chore(bot): ğŸ¤– automated sync"
            "chore(bot): ğŸš€ pipeline activity"
            "chore(bot): ğŸ legendary commit"
            "chore(bot): ğŸ‘» ghost update"
            "chore(bot): ğŸ§  system intelligence"
            "chore(bot): ğŸ’£ chaos injected"
            "chore(bot): ğŸŸ¢ keep alive"
            "chore(bot): ğŸ” integrity pulse"
          )

          count=$((RANDOM % (MAX_COMMITS - MIN_COMMITS + 1) + MIN_COMMITS))
          echo "Commits to make: $count"

          for ((i=1;i<=count;i++)); do
            msg=${messages[RANDOM % ${#messages[@]}]}
            echo "data $i - $(date)" > auto_file_$i.log
            git add -A

            if git diff --cached --quiet; then
              echo "No changes detected"
              if [[ "${{ github.event.inputs.force }}" != "true" ]]; then
                echo "Skipping commit"
                continue
              fi
            fi

            git commit -m "$msg"
            sleep $((RANDOM % 5 + 1))
          done

      - name: ğŸš€ Push changes
        run: git push origin main
